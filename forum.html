<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Webpage</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        #comments {
            border: 1px solid #ccc;
            padding: 10px;
            margin-bottom: 20px;
        }
        .comment {
            margin-bottom: 10px;
        }
        .reply {
            margin-left: 20px;
        }
        button {
            margin-right: 10px;
        }
        .reply-controls {
            margin-top: 10px;
        }
        /* Styles for the modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background-color: #fff;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
        }
        .close {
            position: absolute;
            top: 10px;
            right: 10px;
            cursor: pointer;
        }
    </style>
</head>
<body>

<h1>Your Webpage</h1>

<!-- Your existing content goes here -->

<!-- Comments section -->
<div id="comments">
    <h2>Total Comments: <span id="totalComments">0</span></h2>
    <div id="commentList"></div>

    <label for="newComment">Add a Comment:</label>
    <textarea id="newComment" rows="4" cols="50"></textarea>
    <button onclick="addComment()">Add Comment</button>
</div>

<!-- Modal for reporting -->
<div id="reportModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeReportModal()">&times;</span>
        <h2>Report Comment/Reply</h2>
        <label for="reportReason">Select a reason:</label>
        <select id="reportReason">
            <option value="inappropriate">Inappropriate content</option>
            <option value="spam">Spam</option>
            <option value="harassment">Harassment</option>
            <!-- Add more options as needed -->
        </select>
        <br>
        <label for="additionalComments">Additional Comments (optional):</label>
        <textarea id="additionalComments" rows="4" cols="50"></textarea>
        <br>
        <button onclick="submitReport()">Submit Report</button>
        <p id="reportConfirmation"></p>
    </div>
</div>

<script>
    // Mock database to store comments
    let commentsDatabase = [];
    let commentCounter = 0;
    let reportTarget = null;

    // Function to add a new comment
    function addComment() {
        const newCommentContent = document.getElementById('newComment').value;

        if (newCommentContent.trim() === '') {
            alert('Comment content cannot be empty.');
            return;
        }

        const newComment = {
            user: `Comment ${++commentCounter}`,
            content: newCommentContent,
            likes: 0,
            dislikes: 0,
            likedByUser: false,
            dislikedByUser: false,
            reported: false,
            replies: [],
            collapsed: false, // New property to track collapse/expand state
        };

        commentsDatabase.push(newComment);
        displayComments();

        // Clear input field
        document.getElementById('newComment').value = '';
    }

    // Function to display comments
    function displayComments() {
        const commentListContainer = document.getElementById('commentList');
        const totalCommentsSpan = document.getElementById('totalComments');
        commentListContainer.innerHTML = '';

        let totalComments = 0;

        commentsDatabase.forEach((comment, index) => {
            totalComments++;

            const commentElement = document.createElement('div');
            commentElement.className = 'comment';
            commentElement.innerHTML = `
                <p><strong>${comment.user}:</strong> ${comment.content}</p>
                <div class="reply-controls">
                    <button onclick="likeComment(${index})" ${comment.likedByUser ? 'disabled' : ''}>Like (${comment.likes})</button>
                    <button onclick="dislikeComment(${index})" ${comment.dislikedByUser ? 'disabled' : ''}>Dislike (${comment.dislikes})</button>
                    <button onclick="openReportModal(${index})">Report</button>
                    <button onclick="toggleReplies(${index})">${comment.collapsed ? `Expand Replies (${comment.replies.length})` : 'Collapse Replies'}</button>
                    <span>${comment.likedByUser ? 'Liked!' : ''}</span>
                    <span>${comment.dislikedByUser ? 'Disliked!' : ''}</span>
                    <span>${comment.reported ? 'Reported!' : ''}</span>
                    <input type="text" id="newReply${index}" placeholder="Reply to this comment">
                    <button onclick="addReply(${index}, null, 'newReply${index}')">Add Reply</button>
                </div>
            `;

            // Display replies as comments
            if (!comment.collapsed && comment.replies.length > 0) {
                comment.replies.forEach((reply, replyIndex) => {
                    totalComments++;

                    const replyElement = document.createElement('div');
                    replyElement.className = 'comment reply';
                    replyElement.innerHTML = `
                        <p><strong>${reply.user}:</strong> ${reply.content}</p>
                        <div class="reply-controls">
                            <button onclick="likeReply(${index}, ${replyIndex})" ${reply.likedByUser ? 'disabled' : ''}>Like (${reply.likes})</button>
                            <button onclick="dislikeReply(${index}, ${replyIndex})" ${reply.dislikedByUser ? 'disabled' : ''}>Dislike (${reply.dislikes})</button>
                            <button onclick="openReportModal(${index}, ${replyIndex})">Report</button>
                            <button onclick="toggleReplies(${index}, ${replyIndex})">${reply.collapsed ? `Expand Replies (${reply.replies.length})` : 'Collapse Replies'}</button>
                            <span>${reply.likedByUser ? 'Liked!' : ''}</span>
                            <span>${reply.dislikedByUser ? 'Disliked!' : ''}</span>
                            <span>${reply.reported ? 'Reported!' : ''}</span>
                            <input type="text" id="newReply${index}-${replyIndex}" placeholder="Reply to this reply">
                            <button onclick="addReply(${index}, ${replyIndex}, 'newReply${index}-${replyIndex}')">Add Reply</button>
                        </div>
                    `;

                    // Display replies to replies
                    if (!reply.collapsed && reply.replies.length > 0) {
                        reply.replies.forEach((replyToReply, replyToReplyIndex) => {
                            totalComments++;

                            const replyToReplyElement = document.createElement('div');
                            replyToReplyElement.className = 'comment reply';
                            replyToReplyElement.innerHTML = `
                                <p><strong>${replyToReply.user}:</strong> ${replyToReply.content}</p>
                                <div class="reply-controls">
                                    <button onclick="likeReply(${index}, ${replyIndex}, ${replyToReplyIndex})" ${replyToReply.likedByUser ? 'disabled' : ''}>Like (${replyToReply.likes})</button>
                                    <button onclick="dislikeReply(${index}, ${replyIndex}, ${replyToReplyIndex})" ${replyToReply.dislikedByUser ? 'disabled' : ''}>Dislike (${replyToReply.dislikes})</button>
                                    <button onclick="openReportModal(${index}, ${replyIndex}, ${replyToReplyIndex})">Report</button>
                                    <button onclick="toggleReplies(${index}, ${replyIndex}, ${replyToReplyIndex})">${replyToReply.collapsed ? `Expand Replies (${replyToReply.replies.length})` : 'Collapse Replies'}</button>
                                    <span>${replyToReply.likedByUser ? 'Liked!' : ''}</span>
                                    <span>${replyToReply.dislikedByUser ? 'Disliked!' : ''}</span>
                                    <span>${replyToReply.reported ? 'Reported!' : ''}</span>
                                    <input type="text" id="newReply${index}-${replyIndex}-${replyToReplyIndex}" placeholder="Reply to this reply">
                                    <button onclick="addReply(${index}, ${replyIndex}, 'newReply${index}-${replyIndex}-${replyToReplyIndex}')">Add Reply</button>
                                </div>
                            `;

                            replyElement.appendChild(replyToReplyElement);
                        });
                    }

                    commentElement.appendChild(replyElement);
                });
            }

            commentListContainer.appendChild(commentElement);
        });

        totalCommentsSpan.textContent = totalComments;
    }

    // Function to toggle visibility of replies
    function toggleReplies(commentIndex, replyIndex) {
        if (replyIndex === undefined) {
            // Toggle comments
            commentsDatabase[commentIndex].collapsed = !commentsDatabase[commentIndex].collapsed;
        } else {
            // Toggle replies
            commentsDatabase[commentIndex].replies[replyIndex].collapsed = !commentsDatabase[commentIndex].replies[replyIndex].collapsed;
        }

        displayComments();
    }

    // Function to like a comment
    function likeComment(commentIndex) {
        commentsDatabase[commentIndex].likedByUser = !commentsDatabase[commentIndex].likedByUser;

        if (commentsDatabase[commentIndex].likedByUser) {
            commentsDatabase[commentIndex].likes++;
            commentsDatabase[commentIndex].dislikedByUser = false;
        } else {
            commentsDatabase[commentIndex].likes--;
        }

        displayComments();
    }

    // Function to dislike a comment
    function dislikeComment(commentIndex) {
        commentsDatabase[commentIndex].dislikedByUser = !commentsDatabase[commentIndex].dislikedByUser;

        if (commentsDatabase[commentIndex].dislikedByUser) {
            commentsDatabase[commentIndex].dislikes++;
            commentsDatabase[commentIndex].likedByUser = false;
        } else {
            commentsDatabase[commentIndex].dislikes--;
        }

        displayComments();
    }

    // Function to dislike a reply
    function dislikeReply(commentIndex, replyIndex) {
        commentsDatabase[commentIndex].replies[replyIndex].dislikedByUser = !commentsDatabase[commentIndex].replies[replyIndex].dislikedByUser;

        if (commentsDatabase[commentIndex].replies[replyIndex].dislikedByUser) {
            commentsDatabase[commentIndex].replies[replyIndex].dislikes++;
            commentsDatabase[commentIndex].replies[replyIndex].likedByUser = false;
        } else {
            commentsDatabase[commentIndex].replies[replyIndex].dislikes--;
        }

        displayComments();
    }

    // Function to add a reply to a comment or reply
    function addReply(commentIndex, replyIndex, inputId) {
        const replyContent = document.getElementById(inputId).value;

        if (replyContent.trim() === '') {
            alert('Reply content cannot be empty.');
            return;
        }

        const newReply = {
            user: `Comment ${++commentCounter}`,
            content: replyContent,
            likes: 0,
            dislikes: 0,
            likedByUser: false,
            dislikedByUser: false,
            reported: false,
            replies: [],
            collapsed: false, // New property to track collapse/expand state
        };

        if (replyIndex !== null) {
            // Reply to a reply
            commentsDatabase[commentIndex].replies[replyIndex].replies.push(newReply);
        } else {
            // Reply to a comment
            commentsDatabase[commentIndex].replies.push(newReply);
        }

        displayComments();
    }

    // Function to report a comment
    function reportComment(commentIndex) {
        commentsDatabase[commentIndex].reported = true;
        displayComments();
    }

    // Function to report a reply
    function reportReply(commentIndex, replyIndex) {
        commentsDatabase[commentIndex].replies[replyIndex].reported = true;
        displayComments();
    }

    // Add the following functions to handle the report modal

    // Function to open the report modal
    function openReportModal(commentIndex, replyIndex) {
        document.getElementById('reportModal').style.display = 'block';
        modalCommentIndex = commentIndex;
        modalReplyIndex = replyIndex;
    }

    // Function to close the report modal
    function closeReportModal() {
        document.getElementById('reportModal').style.display = 'none';
    }

    // Function to submit the report
    function submitReport() {
        const reportReason = document.getElementById('reportReason').value;
        const additionalComments = document.getElementById('additionalComments').value;

        if (modalCommentIndex !== null && modalReplyIndex === null) {
            // Report comment
            commentsDatabase[modalCommentIndex].reported = true;
            commentsDatabase[modalCommentIndex].reportReason = reportReason;
            commentsDatabase[modalCommentIndex].additionalComments = additionalComments;
        } else if (modalCommentIndex !== null && modalReplyIndex !== null) {
            // Report reply
            commentsDatabase[modalCommentIndex].replies[modalReplyIndex].reported = true;
            commentsDatabase[modalCommentIndex].replies[modalReplyIndex].reportReason = reportReason;
            commentsDatabase[modalCommentIndex].replies[modalReplyIndex].additionalComments = additionalComments;
        }

        displayComments();

        // Clear modal fields and show confirmation
        document.getElementById('reportReason').value = 'inappropriate'; // Reset to default option
        document.getElementById('additionalComments').value = '';
        document.getElementById('reportConfirmation').innerText = 'Report submitted successfully!';
        setTimeout(function () {
            document.getElementById('reportModal').style.display = 'none';
            document.getElementById('reportConfirmation').innerText = '';
        }, 2000); // Hide modal after 2 seconds
    }

    // Add the following code to initialize variables at the beginning of the script
    let modalCommentIndex = null;
    let modalReplyIndex = null;

    // Initial display
    displayComments();
</script>

</body>
</html>

